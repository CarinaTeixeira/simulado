#!/usr/bin/env node
const fs = require('fs');
const Simulado = require('../src');
const commands = require('commander');

commands
  .option('-p, --port <port>', 'Port to listen on')
  .option('-f, --file <filepath>', 'Path to a mocks JSON file to mock on startup')
  .parse(process.argv)

Simulado.start(commands.port || 7001);

if (commands.file) {
  console.log(`Mocking endpoint in '${commands.file}'`);

  const fileContents = fs.readFileSync(commands.file);
  const parsedMocks = JSON.parse(fileContents);
  
  Simulado.addMocks(parsedMocks).catch(() => {
    console.error(`* ERR: Failed to mock endpoints in '${commands.file}'`);
    console.error('* ERR: Check you have a valid json format');
    console.error('* ERR: The file must contain an Array of MockResponses');
    process.exit(1);
  });
}
